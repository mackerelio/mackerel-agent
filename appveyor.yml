version: 0.19.{build}
clone_folder: c:\gopath\src\github.com\mackerelio\mackerel-agent
environment:
  GOPATH: c:\gopath
  GO111MODULE: on
  SIGNTOOL: C:\Program Files (x86)\Microsoft SDKs\Windows\v7.1A\Bin\signtool.exe
  CERT:
    secure: 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
  CERTPASS:
    secure: zCcHe1kV2WqQisMVNCaWSXdBdiHNMCBKSXNJeVEG/gI=
  matrix:
    - PLATFORM_ID: x86
      GOROOT: c:\go112-x86
      MINGW: C:\MinGW
    - PLATFORM_ID: x64
      MSI_SUFFIX: -x64
      GOROOT: c:\go112
      MINGW: C:\mingw-w64\x86_64-7.2.0-posix-seh-rt_v5-rev1\mingw64
install:
  - md c:\mackerel-secure
  - ps: if ($env:CERT) { Set-Content c:\mackerel-secure\cert.p12.base64 $env:CERT }
  - ps: if ($env:CERTPASS) { Set-Content c:\mackerel-secure\certpass $env:CERTPASS }
  - set PATH=%GOROOT%\bin;%GOPATH%\bin;%PATH%;%MINGW%\bin
  - echo %Path%
  - go version
  - go env
  - set CERT= & set CERTPASS= & set
build_script:
  - call wix\build.bat
test_script:
- FOR /F "usebackq" %%w IN (`git rev-parse --show-cdup`) DO SET CDUP=%%w
- cd %CDUP%
- go vet -all .
- go test -short ./...
- call wix\pluginlist_test.bat
notifications:
  - provider: Slack
    auth_token:
      secure: A7QmXiJAvb+wWfCyBXGCDmKpe7mEDywYI7Ai1LLEi8NNAssCJusGjCpHNv7KiRZz
    channel: mackerel
deploy:
  release: $(appveyor_repo_tag_name)
  provider: GitHub
  auth_token:
    secure: nT6f+l3sILrBAyVGLE1il+wkv5BvrnEnVkiPGDZQegePa81MUC4AIDTNQ/gX8AWW
  artifact: mackerel-agent-msi
  appveyor_repo_tag: true
  force_update: true
  on:
    appveyor_repo_tag: true
artifacts:
  - path: 'build\mackerel-agent*.msi'
    name: mackerel-agent-msi
