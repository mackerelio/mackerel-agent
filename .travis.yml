sudo: false
language: go
go:
- 1.5
env:
  global:
  - PATH=/home/travis/gopath/bin:$PATH DEBIAN_FRONTEND=noninteractive
  - secure: "qKQZENPP6MpcmebY62vTV5XWmj+ju/hr9NLYvYQw6fNsWyvF5LtSUlf4juQV9ErxUMasD8URy4esdRv2OCO/kYCB+VK3ZHk7Ew/0lr27znod0O3KKyIuR3VIojir/BUEYyw/t+kP7Jm9BCQ0yv3ps47VGfUGYazO+8qdgohATlNVmJfHC5jgEm9WaxJLVccUrZHddi4jjPh0CenhKpQAlYyRR3JYIStFFcJifp0Q0hUN4Igs+lBjnMb7wwVEynjrb2MRobVDY4Vsl7M4cYekdLICpHll8otKkVr5ta4maGiaK4S+cYKMGczFyQAB8oXYmKFGDXT87sc6zuLF2L5//RZ9YxxzeJ9zqXmSnHqDYQcb+D+UarcYuS2mnp+OnwgtFM3Plgvmcac88qH5t+w/Ta8ZHLgksNYNr9B2pdbpC9A7djsekoGgCBmC9igS5uPtpF0B6WWFjx4lKWKcMEuvXA894aD3lu3P2t1XCn/LxOW2wv8YFmqQut83nTI5ZflBaikiJN+aL5Q7CR5nOFkKn4mlo17laZpuY1VLXN6ogpPNalKpTnbl2u1p9c48BTlfSiY4P4tWnQ/VI8RWQAlNkGM+LcvZZAtiA71INSHJJKIsz2lbjGn2m5m/fz8MggfJXis2XkpvlCsjaMROttf7i22WPZIf4M3QUgzxJk6CYFM="
sudo: false
addons:
  apt:
    packages:
      - rpm
      - devscripts
      - debhelper
install:
- mkdir -p ~/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}
script:
- make lint
- make cover
- test `gofmt -l . | wc -l` = 0
- make crossbuild
after_script:
- goveralls -coverprofile=.profile.cov
before_deploy:
- make rpm deb rpm-kcps deb-kcps
- go get github.com/aktau/github-release
- mkdir -p ~/bin
- git clone https://github.com/github/hub.git && cd hub && script/build -o ~/bin/hub && cd ..
- echo $TRAVIS_BRANCH
- git config --add remote.origin.fetch '+refs/heads/*:refs/remotes/origin/*'
- git fetch
- git checkout master || git checkout -b master origin/master
- git checkout $TRAVIS_BRANCH
- git fetch --depth=1000
- git fetch --tags --depth=1000 || true
deploy:
- provider: script
  script: _tools/releng --task=upload-to-github-release -v
  skip_cleanup: true
  on:
    branch: master
- provider: script
  script: _tools/releng --task=create-pullrequest --current-branch=$TRAVIS_BRANCH -v
  skip_cleanup: true
  on:
    all_branches: true
    condition: "$TRAVIS_BRANCH =~ ^bump-version-.*$"
